#:kivy 1.11.1

<TopicsSelectionScreen>:

    BoxLayout:
        id: top_box
        #diviser l'écran en deux
        orientation: "horizontal"
        size: root.size
        pos: root.pos
        spacing: 60


        BoxLayout:
            #barre latérale
            id: lateral
            orientation: "vertical"
            size_hint: 0.2, 1 #la barre latéral prend 20% de l'espace à l'écran
            pos: root.pos

            #couleur de fond
            canvas:
                Color:
                    rgb: (.349, .5686, .392, 1)

                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 0, 20, 20, 0 #TOP-L, TOP-R, BOTTOM-R, BOTTOM-L
            
            BoxLayout:
                id: bottom_box
                orientation: 'vertical'
                spacing: 80
                padding:[60, 100, 60, 0]


                Label:
                    background_normal: ''
                    text: 'VideGraff'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.2
                    height: 40
                    width: 260
                    font_size: 65
                    halign: "center"
                    text_size: self.size
                    bold: True

                Label:
                    background_normal: ''
                    text: 'Essaie un de ces gestes !'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.1
                    height: 40
                    width: 260
                    font_size: 38
                    halign: "left"
                    text_size: self.size
                    bold: True

                Button:
                    id: button_1
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Sélectionner"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_2
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Vers le bas"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_3
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Vers le haut"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_4
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Vers la droite"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_4
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 240
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_x: None
                        size_hint_y: None
                        spacing: 30
                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Vers la gauche"
                            text_size: self.size
                            valign: "center"        
                Widget:
            
                FloatLayout:
                    Image:
                        source: "chibi_side_bar.png"
                        size_hint_x: 1
                        size_hint_y: None
                        size: self.texture_size
                        anchor_x: "center"
                        anchor_y: "center"


<Header>:
    BoxLayout:
        orientation: 'vertical'
        size: root.size
        pos: root.pos
        spacing: 30
        id: content_box

        StackLayout:
            orientation: 'lr-tb'
            size_hint_x: 2
            size_hint_y: .1
            

            Label:
                text: "Sujets chauds du moment"
                bold: True
                font_size: 50
                text_size: self.size
                color: .349, .5686, .392, 1
            

<Topics>:

    GridLayout:
        id: contents
        cols: 3
        size: root.size
        pos: root.pos
        spacing: 100
        padding: [0, 50, 100, 100]
        #on_parent:
            #for i in range(11): txt = "Label {0}".format(i); self.add_widget(Label(text = txt, text_size=(cm(2), cm(2)), pos=self.pos,
            #id=txt, color=(1,0,0,1)))

<Subject>:
    Button:
        id: button_subject
        pos: self.parent.pos
        size: self.parent.size
        text: "" if app.subjectName is None else "%s" % (app.subjectName) #subject name not displayed here
        color: 1, 0, 0, 0
        background_color: 0, 0, 0, 0

        on_press:
            app.topicsSelectionScreen.manager.transition.direction = 'left' 
            app.topicsSelectionScreen.manager.transition.duration = 0
            app.topicsSelectionScreen.manager.current = 'screen_TopicDisplay'
            app.subjectTitle = self.text
            app.currentDescription = app.subjectDescription[self.text]
            app.displayInterventions()

        canvas.before:
            Color:
                rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .2)

            RoundedRectangle:
                size: self.parent.size
                pos: self.parent.pos
                radius: 40, 40, 40, 40

        BoxLayout:
            orientation: "vertical"
            size: self.parent.size
            pos: self.parent.pos
            padding: [50, 50, 50, 100]
            spacing: 60

            Label:
                text: "" if app.subjectName is None else "%s" % (app.subjectName) # subject name displayed here
                color: .349, .5686, .392, 1
                font_size: 48
                #underline: True
                text_size: self.size
                pos: self.parent.pos
                halign: "center"
            
            Image:
                source: "" if app.subjectName is None else "data/%s/subject/subject_image.jpg" % (app.subjectName) #subject name not displayed here
                keep_ratio: True
                size_hint_y: 3
                size: self.parent.size
                pos: self.parent.pos
                        
            
            GridLayout:
                cols: 5
                pos: self.parent.pos
                size: self.parent.size
                padding: [80, 0, 80, 0]
                size_hint_y: 0.3
                spacing: 20

                
                Image:
                    source: 'camera.png'
                    size_hint_x: 1
                    width: 50
                    valign: "center"

                Label:
                    color: .349, .5686, .392, 1
                    size_hint_x: 1
                    font_size: 38
                    halign: "center"
                    height: 50
                    width: 80
                    text: "" if app.subjectCamNb is None else "%s" % (app.subjectCamNb)
                    text_size: self.size
                    valign: "center" 
                
                Widget:

                Image:
                    source: 'paint_spray.png'
                    size_hint_x: 1
                    size_hint_y: 2
                    height: 200
                    valign: "center"
                    keep_ratio: True

                Label:
                    color: .349, .5686, .392, 1
                    size_hint_x: 1
                    font_size: 38
                    halign: "center"
                    height: 50
                    width: 80
                    text: "" if app.subjectGrafNb is None else "%s" % (app.subjectGrafNb)
                    text_size: self.size
                    valign: "center" 
                        


<TopicDisplayScreen>:
    on_enter:
        app.test()

    BoxLayout:
        id: top_box
        #diviser l'écran en deux
        orientation: "horizontal"
        size: root.size
        pos: root.pos
        spacing: 60

        canvas.before:
            Rectangle:
                pos: self.parent.pos
                size: [self.parent.size[0], self.parent.size[1]/2]
                source: "people_background.png"
        

        BoxLayout:
            #barre latérale
            id: lateral
            orientation: "vertical"
            size_hint: 0.2, 1 #la barre latéral prend 20% de l'espace à l'écran
            pos: root.pos

            #couleur de fond
            canvas:
                Color:
                    rgb: (.349, .5686, .392, 1)

                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 0, 20, 20, 0 #TOP-L, TOP-R, BOTTOM-R, BOTTOM-L
            
            BoxLayout:
                id: bottom_box
                orientation: 'vertical'
                spacing: 80
                padding:[60, 100, 60, 0]

                Label:
                    background_normal: ''
                    text: 'VideGraff'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.2
                    height: 40
                    width: 260
                    font_size: 65
                    halign: "center"
                    text_size: self.size
                    bold: True
                
                Label:
                    background_normal: ''
                    text: 'Essaie un de ces gestes !'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.1
                    height: 40
                    width: 260
                    font_size: 34
                    halign: "left"
                    text_size: self.size
                    bold: True

                Button:
                    id: button_1
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                    
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_InterventionDisplayed'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Sélectionner"
                            text_size: self.size
                            valign: "center"
                Label:
                    id: button_2
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'tb-lr'
                        size_hint_y: None
                        spacing: 30

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Contribuer"
                            text_size: self.size
                            valign: "center"
                            bold: True
                Button:
                    id: button_3
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_AddGraffiti'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding:[80, 0, 0, 0]

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Graffiti"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_4
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_AddVideo'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding:[80, 0, 0, 0]

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Vidéo"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_4
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 240
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'right' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_TopicsSelection'
                        app.remove_bubble()


                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_x: None
                        size_hint_y: None
                        spacing: 30
                        

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Retour aux sujets"
                            text_size: self.size
                            valign: "center"        
                Widget:

            
                FloatLayout:
                    Image:
                        source: "chibi_side_bar.png"
                        size_hint_x: 1
                        size_hint_y: None
                        size: self.texture_size
                        anchor_x: "center"
                        anchor_y: "center"

    FloatLayout:
        size: root.size
        pos: root.pos
        id: floatBulle


<Bulle>:
    Image:
        source: "" if app.displayBubble is False else "bulle_chibi_side.png"
        size_hint_x: None
        size_hint_y: None
        size: 800, 800
        keep_ratio: True
        pos_hint: {"x": 0.0, "y": 0.2}
        #color: app.color
            
                    


<HeaderTopicName>:

    BoxLayout:
        orientation: 'vertical'
        size: root.size
        pos: root.pos
        spacing: 30
        id: content_box


<InterventionsSelection>:
    BoxLayout:
        #interventions à gauche et chibi avec bulle à droite
        orientation: "horizontal"
        pos: self.parent.pos
        size: self.parent.size

        BoxLayout:
            id: intervention_box
            #pour ajouter le widget et tout remonter
            orientation: "vertical"
            size_hint: 2, 1
            pos: self.parent.pos
            size: self.parent.size

            StackLayout:
                orientation: "lr-tb"
                size_hint_y: 0.6
                padding: [0, 40, 0, 0]
                


                Button:
                    text: ""
                    color: 1, 1, 1, 0
                    background_color: 1, 0, 0, 0
                    size_hint_x: .25

                    on_press:
                        app.topicsSelectionScreen.manager.transition.direction = 'right' 
                        app.topicsSelectionScreen.manager.transition.duration = 0
                        app.topicsSelectionScreen.manager.current = 'screen_TopicsSelection'
                        app.remove_bubble()

                    StackLayout:
                        orientation: 'lr-tb'
                        size: self.parent.size
                        pos: self.parent.pos
                        spacing: 30

                        Image:
                            source: 'back.png'
                            size_hint_x: None
                            width: 50
                            valign: "center"
                            keep_ratio: True

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 300
                            text: "Retour"
                            text_size: self.size
                            valign: "center"
                            color: .349, .5686, .392, 1
                            bold: True
                            font_size: 50

                
                Widget:

            GridLayout:
                id: intervention_content
                cols: 3
                rows: 5
                size: root.size
                pos: self.parent.pos
                spacing: 100
                size_hint: 1,3

            
            Widget:
    
        BoxLayout:
            orientation: "vertical"

            Button:
                color: 0, 0, 0, 0
                background_color: 0, 0, 0, 0
                pos: self.pos
                size: self.size
                size_hint_y: 2

                on_press:
                    app.interventionsSelection.fire_popup()

                canvas.before:
                    Color:
                        rgba: (1, 1, 1, 1) if self.state == 'normal' else (1, 1, 1, .2)

                    RoundedRectangle:
                        id: ellipse
                        size: self.size
                        pos: self.pos
                        source: "" if app.subjectTitle is None else "data/%s/subject/chibi_subject.png" % (app.subjectTitle)

            GridLayout:
                cols: 1
                padding: [180, 100, 200, 100]
                spacing: 60

                Button:
                    text: ""
                    size: self.parent.size
                    color: 1, 0, 0, 0
                    size_hint_y: 3
                    background_color: 0, 0, 0, 0

                    on_press:
                        app.currentIntervention = ""
                        app.fire_popupAddGraffiti()
                    
                    canvas.before:
                        Color:
                            rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                        RoundedRectangle:
                            size: self.size
                            pos: self.pos
                            radius: 20, 20, 20, 20

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding: [50, 0, 50, 0]

                        Image:
                            source: 'white_paint_spray.png'
                            size_hint_x: None
                            width: 40
                            valign: "center"
                            keep_ratio: True

                        Label:
                            size_hint_x: None
                            halign: "center"
                            height: 40
                            width: 300
                            text: "Ajoute un graffiti"
                            text_size: self.size
                            valign: "center"
                            color: 1, 1, 1, 1
                            bold: True
                            font_size: 34
                
                Button:
                    text: ""
                    size: self.parent.size
                    color: 1, 0, 0, 0
                    size_hint_y: 3
                    background_color: 0, 0, 0, 0
                    disabled: True

                    on_press:
                        app.currentIntervention = ""
                        app.video_state = "play"
                        app.interventionsSelection.fire_popupVideo()
                    
                    canvas.before:
                        Color:
                            rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                        RoundedRectangle:
                            size: self.size
                            pos: self.pos
                            radius: 20, 20, 20, 20

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding: [40, 0, 50, 0]

                        Image:
                            source: 'add_video.png'
                            size_hint_x: None
                            width: 50
                            valign: "left"
                            keep_ratio: True

                        Label:
                            size_hint_x: None
                            halign: "center"
                            height: 40
                            width: 300
                            text: "Ajoute une vidéo"
                            text_size: self.size
                            valign: "center"
                            color: 1, 1, 1, 1
                            bold: True
                            font_size: 34

                Widget:

                        
            
            Widget:
        
        #FloatLayout:
        #    size: root.size
        #    pos: root.pos

        #    Image:
        #        source: "bulle_chibi_side.png"
        #        size_hint_x: None
        #        size_hint_y: None
        #        size: [self.size[0]/1.2,self.size[1]/1.2]
        #        keep_ratio: True
        #        pos_hint: {"x": 0.0, "y": 0.0}


<InterventionsSelectionEmpty>:
    BoxLayout:
        #interventions à gauche et chibi avec bulle à droite
        orientation: "horizontal"
        pos: self.parent.pos
        size: self.parent.size

        BoxLayout:
            id: intervention_box
            #pour ajouter le widget et tout remonter
            orientation: "vertical"
            size_hint: 2, 1
            pos: self.parent.pos
            size: self.parent.size

            StackLayout:
                orientation: "lr-tb"
                size_hint_y: 0.6
                padding: [0, 40, 0, 0]


                Button:
                    text: ""
                    color: 1, 1, 1, 0
                    background_color: 1, 0, 0, 0
                    size_hint_x: .25

                    on_press:
                        app.topicsSelectionScreen.manager.transition.direction = 'right' 
                        app.topicsSelectionScreen.manager.transition.duration = 0
                        app.topicsSelectionScreen.manager.current = 'screen_TopicsSelection'
                        app.remove_bubble()

                    StackLayout:
                        orientation: 'lr-tb'
                        size: self.parent.size
                        pos: self.parent.pos
                        #size_hint_y: .1
                        spacing: 30

                        Image:
                            source: 'back.png'
                            size_hint_x: None
                            width: 50
                            valign: "center"
                            keep_ratio: True

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 300
                            text: "Retour"
                            text_size: self.size
                            valign: "center"
                            color: .349, .5686, .392, 1
                            bold: True
                            font_size: 50

                
                Widget:

            FloatLayout:
                size: self.size
                pos: self.pos
                size_hint: 1,3

                Image:
                    source: "chibiMan.png"
                    size_hint_x: None
                    size_hint_y: None
                    size: [self.parent.size[0]/1.2,self.parent.size[1]/1.2]
                    keep_ratio: True
                    pos_hint: {"x": 0.0, "y": 0.0}

            Widget:

        BoxLayout:
            orientation: "vertical"

            Button:
                color: 0, 0, 0, 0
                background_color: 0, 0, 0, 0
                pos: self.pos
                size: self.size
                size_hint_y: 2

                on_press:
                    app.interventionsSelectionEmpty.fire_popup()

                canvas.before:
                    Color:
                        rgba: (1, 1, 1, 1) if self.state == 'normal' else (1, 1, 1, .2)

                    RoundedRectangle:
                        id: ellipse
                        size: self.size
                        pos: self.pos
                        source: "" if app.subjectTitle is None else "data/%s/subject/chibi_subject.png" % (app.subjectTitle)
                
            GridLayout:
                cols: 1
                padding: [180, 100, 200, 100]
                spacing: 60

                Button:
                    text: ""
                    size: self.parent.size
                    color: 1, 0, 0, 0
                    size_hint_y: 3
                    background_color: 0, 0, 0, 0

                    on_press:
                        app.currentIntervention = ""
                        app.fire_popupAddGraffiti()
                    
                    canvas.before:
                        Color:
                            rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                        RoundedRectangle:
                            size: self.size
                            pos: self.pos
                            radius: 20, 20, 20, 20

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding: [50, 0, 50, 0]

                        Image:
                            source: 'white_paint_spray.png'
                            size_hint_x: None
                            width: 40
                            valign: "center"
                            keep_ratio: True

                        Label:
                            size_hint_x: None
                            halign: "center"
                            height: 40
                            width: 300
                            text: "Ajoute un graffiti"
                            text_size: self.size
                            valign: "center"
                            color: 1, 1, 1, 1
                            bold: True
                            font_size: 34
                
                Button:
                    text: ""
                    size: self.parent.size
                    color: 1, 0, 0, 0
                    size_hint_y: 3
                    background_color: 0, 0, 0, 0
                    disabled: True

                    on_press:
                        app.currentIntervention = ""
                        app.interventionsSelectionEmpty.fire_popupVideo()
                    
                    canvas.before:
                        Color:
                            rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                        RoundedRectangle:
                            size: self.size
                            pos: self.pos
                            radius: 20, 20, 20, 20

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding: [40, 0, 50, 0]

                        Image:
                            source: 'add_video.png'
                            size_hint_x: None
                            width: 50
                            valign: "left"
                            keep_ratio: True

                        Label:
                            size_hint_x: None
                            halign: "center"
                            height: 40
                            width: 300
                            text: "Ajoute une vidéo"
                            text_size: self.size
                            valign: "center"
                            color: 1, 1, 1, 1
                            bold: True
                            font_size: 34

                Widget:
            
            Widget:

<Intervention>:
    Button:
        text: "" if app.interventionView is None else "%s" % (app.interventionView)
        color: 0, 0, 0, 0
        pos: root.pos
        size: [550, 200]
        background_color: 0, 0, 0, 0
        text_size: self.size
        on_press:
            app.currentIntervention = self.text
            app.interventionsSelection.fire_popupGraffiti()

        canvas.before:
            Color:
                rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .2)

            Ellipse:
                id: ellipse
                size: self.size
                pos: self.pos
                source: "" if app.interventionView is None else "%s" % (app.interventionView)

<InterventionVideo>:
    Button:
        text: "" if app.videoPath is None else "%s" % (app.videoPath)
        color: 0, 0, 0, 0
        pos: root.pos
        size: [550, 200]
        background_color: 0, 0, 0, 0
        text_size: self.size
        on_press:
            app.currentIntervention = self.text
            app.graffitiOfVideo = app.retrieveGraffitiName(self.text)
            app.video_state = "play" # auto play video
            app.interventionsSelection.fire_popupVideo()

        canvas.before:
            Color:
                rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .2)

            Ellipse:
                id: ellipse
                size: self.size
                pos: self.pos
                source: "" if app.interventionView is None else "%s" % (app.interventionView)

<InterventionDisplayedScreen>:
    BoxLayout:
        id: top_box
        #diviser l'écran en deux
        orientation: "horizontal"
        size: root.size
        pos: root.pos
        spacing: 60


        BoxLayout:
            #barre latérale
            id: lateral
            orientation: "vertical"
            size_hint: 0.2, 1 #la barre latéral prend 20% de l'espace à l'écran
            pos: root.pos

            #couleur de fond
            canvas:
                Color:
                    rgb: (.349, .5686, .392, 1)

                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 0, 20, 20, 0 #TOP-L, TOP-R, BOTTOM-R, BOTTOM-L
            
            BoxLayout:
                id: bottom_box
                orientation: 'vertical'
                spacing: 80
                padding:[60, 100, 60, 0]

                Label:
                    background_normal: ''
                    text: 'VideGraff'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.2
                    height: 40
                    width: 260
                    font_size: 65
                    halign: "center"
                    text_size: self.size
                    bold: True

                Label:
                    background_normal: ''
                    text: 'Essaie un de ces gestes !'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.1
                    height: 40
                    width: 260
                    font_size: 34
                    halign: "left"
                    text_size: self.size
                    bold: True

                Button:
                    id: button_2
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 350
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_TopicDisplay'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 350
                            text: "Changer d'intervention"
                            text_size: self.size
                            valign: "center"

                Label:
                    id: button_2
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'tb-lr'
                        size_hint_y: None
                        spacing: 30

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Contribuer"
                            text_size: self.size
                            valign: "center"
                            bold: True
                Button:
                    id: button_3
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_AddGraffiti'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding:[80, 0, 0, 0]

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center" 

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Graffiti"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_4
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40

                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_AddVideo'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30
                        padding:[80, 0, 0, 0]

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Vidéo"
                            text_size: self.size
                            valign: "center"
                Button:
                    id: button_4
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 240
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'right' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_TopicsSelection'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_x: None
                        size_hint_y: None
                        spacing: 30
                        

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Retour aux sujets"
                            text_size: self.size
                            valign: "center"  
      
                Widget:
            
                FloatLayout:
                    Image:
                        source: "chibi_side_bar.png"
                        size_hint_x: 1
                        size_hint_y: None
                        size: self.texture_size
                        anchor_x: "center"
                        anchor_y: "center"

<HeaderSubjectTitle>:
    BoxLayout:
        orientation: 'vertical'
        size: root.size
        pos: root.pos
        spacing: 30
        id: content_box

        StackLayout:
            orientation: 'lr-tb'
            size_hint_x: 2
            size_hint_y: .1
            

            Label:
                text: "" if app.subjectTitle is None else "%s" % (app.subjectTitle)
                bold: True
                font_size: 44
                text_size: self.size
                color: .349, .5686, .392, 1

<InterventionContent>:
    BoxLayout:
        id: intervention_content
        orientation: "horizontal"
        size: root.size
        pos: root.pos
        padding:[100]
        spacing: 100
        
        StackLayout:
            orientation: "tb-lr"
            pos: self.pos
            size: self.size
            background_color: 0, 0, 0, 0
            size_hint: 0.5, 1

            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1

                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: 40, 40, 40, 40
            
            GridLayout:
                cols: 1
                pos: self.pos
                size: self.size
                padding: [40, 60, 60, 60]

                Label:
                    text: "Graffiti"
                    text_size: self.size
                    size: self.parent.size
                    size_hint_y: 0.05
                    pos: self.pos
                    color: .349, .5686, .392, 1
                    halign: 'left'
                    bold: True

                Image:
                    source: "" if app.currentIntervention is None else "%s" % (app.currentIntervention)
                    size: self.size
                    pos: self.pos
                    halign: "left"

                Widget:

<AddGraffitiScreen>:
    BoxLayout:
        id: top_box
        #diviser l'écran en deux
        orientation: "horizontal"
        size: root.size
        pos: root.pos
        spacing: 60


        BoxLayout:
            #barre latérale
            id: lateral
            orientation: "vertical"
            size_hint: 0.2, 1 #la barre latéral prend 20% de l'espace à l'écran
            pos: root.pos

            #couleur de fond
            canvas:
                Color:
                    rgb: (.349, .5686, .392, 1)

                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 0, 20, 20, 0 #TOP-L, TOP-R, BOTTOM-R, BOTTOM-L
            
            BoxLayout:
                id: bottom_box
                orientation: 'vertical'
                spacing: 80
                padding:[60, 100, 60, 0]

                Label:
                    background_normal: ''
                    text: 'VideGraff'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.2
                    height: 40
                    width: 260
                    font_size: 65
                    halign: "center"
                    text_size: self.size
                    bold: True

                Label:
                    background_normal: ''
                    text: 'Essaie un de ces gestes !'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.1
                    height: 40
                    width: 260
                    font_size: 34
                    halign: "left"
                    text_size: self.size
                    bold: True

                Button:
                    id: button_1
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_TopicDisplay'
                        app.addGraffitiContentRef.ids.painter_widget.export_scaled_png('data/%s/' % (app.subjectTitle), image_scale=float("2"))
                        app.clear_graff()
                        app.updateGraffitiNumberDB()
                        app.displayInterventions()

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 300
                            text: "Ajouter le graffiti"
                            text_size: self.size
                            valign: "center"
                
                Button:
                    id: button_3
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_TopicsSelection'
                        app.clear_graff()

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Annuler"
                            text_size: self.size
                            valign: "center"
                  
                Widget:
            
                FloatLayout:
                    Image:
                        source: "chibi_side_bar.png"
                        size_hint_x: 1
                        size_hint_y: None
                        size: self.texture_size
                        anchor_x: "center"
                        anchor_y: "center"

<AddGraffitiContent>:
    BoxLayout:
        orientation: "vertical"
        padding: [30, 60, 100, 100]
        size: root.size
        pos: root.pos

        GridLayout:
            cols: 1
            size: root.size
            pos: root.pos
            id: graffiti_draw

            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 40, 40, 40, 40
            
            BoxLayout:
                orientation: "vertical"
                size: self.size
                pos: self.pos

                Label:
                    text: "Graffiti"
                    color: .349, .5686, .392, 1
                    bold: True
                    halign: "left"
                    valign: "top"
                    size_hint: 0.08, 0.1

                GridLayout:
                    cols: 1

                    MyWidget:
                        id: painter_widget
                        
                    
<AddVideoScreen>:
    BoxLayout:
        id: top_box
        #diviser l'écran en deux
        orientation: "horizontal"
        size: root.size
        pos: root.pos
        spacing: 60


        BoxLayout:
            #barre latérale
            id: lateral
            orientation: "vertical"
            size_hint: 0.2, 1 #la barre latéral prend 20% de l'espace à l'écran
            pos: root.pos

            #couleur de fond
            canvas:
                Color:
                    rgb: (.349, .5686, .392, 1)

                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 0, 20, 20, 0 #TOP-L, TOP-R, BOTTOM-R, BOTTOM-L
            
            BoxLayout:
                id: bottom_box
                orientation: 'vertical'
                spacing: 80
                padding:[60, 100, 60, 0]

                Label:
                    background_normal: ''
                    text: 'VideGraff'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.2
                    height: 40
                    width: 260
                    font_size: 65
                    halign: "center"
                    text_size: self.size
                    bold: True

                Label:
                    background_normal: ''
                    text: 'Essaie un de ces gestes !'
                    color: 1, 1, 1, 1
                    size_hint_y: 0.1
                    height: 40
                    width: 260
                    font_size: 34
                    halign: "left"
                    text_size: self.size
                    bold: True

                Button:
                    id: button_1
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                    on_press:
                        #root.manager.transition.direction = 'left' 
                        #root.manager.transition.duration = 0
                        #root.manager.current = 'screen_TopicsSelection'
                        #app.addVideoContentRef.record_video()

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 300
                            text: "Enregistrer/Stopper"
                            text_size: self.size
                            valign: "center"
                
                Button:
                    id: button_3
                    background_normal: ''
                    background_color: .349, .5686, .392, 1
                    size_hint_y: 0.10
                    width: 260
                    height: 40
                     
                    on_press:
                        root.manager.transition.direction = 'left' 
                        root.manager.transition.duration = 0
                        root.manager.current = 'screen_TopicsSelection'

                    StackLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        orientation: 'lr-tb'
                        size_hint_y: None
                        spacing: 30

                        Image:
                            source: 'hand.png'
                            size_hint_x: None
                            width: 30
                            valign: "center"

                        Label:
                            size_hint_x: None
                            halign: "left"
                            height: 40
                            width: 260
                            text: "Annuler"
                            text_size: self.size
                            valign: "center"
                  
                Widget:
            
                FloatLayout:
                    Image:
                        source: "chibi_side_bar.png"
                        size_hint_x: 1
                        size_hint_y: None
                        size: self.texture_size
                        anchor_x: "center"
                        anchor_y: "center"

<AddVideoContent>:
    BoxLayout:
        orientation: "vertical"
        padding: [30, 60, 100, 100]
        size: root.size
        pos: root.pos

        GridLayout:
            cols: 1
            size: self.size
            pos: self.pos
            id: graffiti_draw

            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: 40, 40, 40, 40
            
            BoxLayout:
                id: camera_display
                orientation: "vertical"
                size: self.size
                pos: self.pos
                padding: [90, 0, 0, 30]

                Label:
                    text: "Enregistrement vidéo"
                    color: .349, .5686, .392, 1
                    bold: True
                    halign: "left"
                    valign: "top"
                    size_hint: 0.08, 0.15
                Widget:

                GridLayout:
                    cols: 1

                    Camera:
                        id: recorder_widget
                        
                    



<DescriptionPopup>:
    id: descriptionPopup
    size_hint: .3, .3
    auto_dismiss: True
    title: "" if app.subjectTitle is None else '%s' % (app.subjectTitle) 
    title_color: .349, .5686, .392, 1
    title_size: 40
    separator_color: .349, .5686, .392, 1
    background: "popup_background.png"

    GridLayout:
        cols: 1
        padding: [20, 30, 20, 30]
        size: self.size

        Label:
            text: "" if app.currentDescription is None else "%s" % (app.currentDescription)
            color: .588, .588, .588, 1
            text_size: self.size
            size_hint : 1.0, 1.0
            halign: "left"
            valign: "top"
        

<GraffitiPopup>:
    id: graffitiPopup
    size_hint: .6, .6
    auto_dismiss: True
    title: "" if app.subjectTitle is None else '%s' % (app.subjectTitle) 
    title_color: .349, .5686, .392, 1
    title_size: 45
    separator_color: .349, .5686, .392, 1
    background: "popup_background.png"

    GridLayout:
        cols: 1
        padding: [20, 30, 20, 30]
        size: self.size
        pos: self.pos
        
        Image:
            source: "" if app.currentIntervention is None else "%s" % (app.currentIntervention)
            pos: self.parent.pos
            size: self.parent.size
            keep_ratio: True
            size_hint_y: 2
        
        GridLayout:
            # bottom buttons - retour and modifier
            cols: 3
            size_hint_y: 0.3
            padding: [100, 20, 100, 20]
            spacing: 100

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 1
                background_color: 0, 0, 0, 0

                on_press:
                    app.currentIntervention = ""
                    graffitiPopup.dismiss()
                    #app.remove_bubble()
                
                canvas.before:
                    Color:
                        rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 10, 10, 10, 10
                        source: "rounded_border.png"
                

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'back.png'
                        size_hint_x: None
                        width: 40
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Retour"
                        text_size: self.size
                        valign: "center"
                        color: .349, .5686, .392, 1
                        bold: True
                        font_size: 34
            MyWidget:
                id: painter_widget

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 0
                background_color: 0, 0, 0, 0

                on_press:
                    graffitiPopup.dismiss()
                    app.fire_popupAddGraffiti()
                
                canvas.before:
                    Color:
                        rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 20, 20, 20, 20

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'edit.png'
                        size_hint_x: None
                        width: 40
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Modifier"
                        text_size: self.size
                        valign: "center"
                        color: 1, 1, 1, 1
                        bold: True
                        font_size: 34

<AddGraffitiPopup>:
    id: addGraffitiPopup
    size_hint: .6, .6
    auto_dismiss: False
    title: "" if app.subjectTitle is None else '%s' % (app.subjectTitle) 
    title_color: .349, .5686, .392, 1
    title_size: 45
    separator_color: .349, .5686, .392, 1
    background: "popup_background.png"

    GridLayout:
        cols: 1
        padding: [20, 30, 20, 30]
        size: self.size
        pos: self.pos
        
        
        MyWidget:
            id: painter_widget

            FloatLayout:
                size: self.size
                pos: self.pos

            Image:
                size: self.parent.size
                pos: self.parent.pos
                source: "" if app.currentIntervention is None else "%s" % (app.currentIntervention)

        GridLayout:
            # bottom buttons - annuler and valider
            cols: 3
            size_hint_y: 0.15
            padding: [100, 20, 100, 20]
            spacing: 100

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 1
                background_color: 0, 0, 0, 0

                on_press:
                    app.currentIntervention = ""
                    addGraffitiPopup.dismiss()
                
                canvas.before:
                    Color:
                        rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 10, 10, 10, 10
                        source: "rounded_border.png"
                

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'cancel.png'
                        size_hint_x: None
                        width: 60
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Annuler"
                        text_size: self.size
                        valign: "center"
                        color: .349, .5686, .392, 1
                        bold: True
                        font_size: 34
            Widget:

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 0
                background_color: 0, 0, 0, 0

                on_press:
                    app.addGraffitiPopup.ids.painter_widget.export_scaled_png('data/%s/' % (app.subjectTitle), image_scale=float("2"), currentIntervention=app.currentIntervention)
                    app.currentIntervention = ""
                    app.updateGraffitiNumberDB()
                    app.displayInterventions()
                    app.interventionsSelection.fire_popupVideo()
                    addGraffitiPopup.dismiss()
                
                canvas.before:
                    Color:
                        rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 20, 20, 20, 20

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'validate.png'
                        size_hint_x: None
                        width: 50
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Valider"
                        text_size: self.size
                        valign: "center"
                        color: 1, 1, 1, 1
                        bold: True
                        font_size: 34
    
<VideoPopup>:
    id: videoPopup
    size_hint: .6, .6
    auto_dismiss: True
    title: "" if app.subjectTitle is None else '%s' % (app.subjectTitle) 
    title_color: .349, .5686, .392, 1
    title_size: 45
    separator_color: .349, .5686, .392, 1
    background: "popup_background.png"

    GridLayout:
        cols: 1
        padding: [20, 30, 20, 30]
        size: self.size
        pos: self.pos
        
        BoxLayout:
            orientation:"horizontal"
            size: self.size
            pos: self.pos
            size_hint: 1, 2

            VideoPlayer:
                id: video
                source: app.currentIntervention
                state: app.video_state
                size_hint: 1, 1
                size: self.size
            
            Image:
                source: "" if app.graffitiOfVideo is None else "%s" % (app.graffitiOfVideo)
                size: self.texture_size
                pos: self.pos

        
        
        GridLayout:
            # bottom buttons - retour and modifier VIDEO
            cols: 3
            size_hint_y: 0.3
            padding: [100, 20, 100, 20]
            spacing: 100

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 1
                background_color: 0, 0, 0, 0

                on_press:
                    app.currentIntervention = ""
                    app.video_state = "pause"
                    videoPopup.dismiss()
                
                canvas.before:
                    Color:
                        rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 10, 10, 10, 10
                        source: "rounded_border.png"
                

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'back.png'
                        size_hint_x: None
                        width: 40
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Retour"
                        text_size: self.size
                        valign: "center"
                        color: .349, .5686, .392, 1
                        bold: True
                        font_size: 34
            MyWidget:
                id: painter_widget

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 0
                background_color: 0, 0, 0, 0

                on_press:
                    app.video_state = "pause"
                    videoPopup.dismiss()
                    app.fire_popupAddVideoGraffiti()
                
                canvas.before:
                    Color:
                        rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 20, 20, 20, 20

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'edit.png'
                        size_hint_x: None
                        width: 40
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Commenter"
                        text_size: self.size
                        valign: "center"
                        color: 1, 1, 1, 1
                        bold: True
                        font_size: 34

<AddVideoGraffitiPopup>:
    id: addVideoGraffitiPopup
    size_hint: .6, .6
    auto_dismiss: False
    title: "" if app.subjectTitle is None else '%s' % (app.subjectTitle) 
    title_color: .349, .5686, .392, 1
    title_size: 45
    separator_color: .349, .5686, .392, 1
    background: "popup_background.png"

    GridLayout:
        cols: 1
        padding: [20, 30, 20, 30]
        size: self.size
        pos: self.pos
        
        
        MyWidget:
            id: painter_widget

            FloatLayout:
                size: self.size
                pos: self.pos

            Image:
                size: self.parent.size
                pos: self.parent.pos
                source: "" if app.graffitiOfVideo is None else "%s" % (app.graffitiOfVideo)

        GridLayout:
            # bottom buttons - annuler and valider
            cols: 3
            size_hint_y: 0.15
            padding: [100, 20, 100, 20]
            spacing: 100

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 1
                background_color: 0, 0, 0, 0

                on_press:
                    app.currentIntervention = ""
                    addVideoGraffitiPopup.dismiss()
                
                canvas.before:
                    Color:
                        rgba: (1, 1, 1, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 10, 10, 10, 10
                        source: "rounded_border.png"
                

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'cancel.png'
                        size_hint_x: None
                        width: 60
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Annuler"
                        text_size: self.size
                        valign: "center"
                        color: .349, .5686, .392, 1
                        bold: True
                        font_size: 34
            Widget:

            Button:
                text: ""
                size: self.size
                color: 1, 0, 0, 0
                background_color: 0, 0, 0, 0

                on_press:
                    app.addVideoGraffitiPopup.ids.painter_widget.export_scaled_png('data/%s/' % (app.subjectTitle), image_scale=float("2"), currentIntervention=app.currentIntervention, graffitiOfVideo=app.graffitiOfVideo)
                    #app.currentIntervention = ""
                    app.updateGraffitiNumberDB()
                    app.displayInterventions()
                    addVideoGraffitiPopup.dismiss()
                
                canvas.before:
                    Color:
                        rgba: (.349, .5686, .392, 1) if self.state == 'normal' else (.349, .5686, .392, .3)

                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: 20, 20, 20, 20

                StackLayout:
                    pos: self.parent.pos
                    size: self.parent.size
                    orientation: 'lr-tb'
                    size_hint_y: None
                    spacing: 30
                    padding: [50, 0, 50, 0]

                    Image:
                        source: 'validate.png'
                        size_hint_x: None
                        width: 50
                        valign: "center"
                        keep_ratio: True

                    Label:
                        size_hint_x: None
                        halign: "center"
                        height: 40
                        width: 300
                        text: "Valider"
                        text_size: self.size
                        valign: "center"
                        color: 1, 1, 1, 1
                        bold: True
                        font_size: 34